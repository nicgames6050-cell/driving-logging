<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Driving Log</title>
<link rel="manifest" href="./manifest.json" />
<meta name="theme-color" content="#2c2c2c" />
<link rel="apple-touch-icon" href="./icons/apple-touch-icon.png" />
<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,'SF Pro Text',Roboto,Arial;background:#121212;color:#fff;height:100vh;display:flex;flex-direction:column}
.header{padding:16px;display:flex;align-items:center;gap:12px}
.logo{height:32px}
.content{flex:1;overflow:auto;padding:16px}
.card{background:#1e1e1e;padding:16px;border-radius:12px;margin-bottom:12px}
.tabbar{display:flex;gap:8px;padding:10px;background:#0b0b0b}
.tab{flex:1;text-align:center;padding:10px;border-radius:10px;background:#121212;cursor:pointer}
.tab.active{background:#1e1e1e}
input,textarea,button{width:100%;padding:12px;border-radius:10px;border:none;margin-top:8px}
iframe{width:100%;height:65vh;border:none;border-radius:8px}
.status{color:#9ca3af;margin-top:8px;font-size:14px}
</style>
</head>
<body>
<header class="header"><img class="logo" src="./icons/apple-touch-icon.png" alt="logo" /><h1>Driving Log</h1></header>
<main class="content">
  <section id="log" class="card">
    <h2>Log Driving Hours</h2>
    <label>Minutes Drove *</label>
    <input id="minutes" type="number" min="0" inputmode="numeric" placeholder="e.g. 45" required />
    <label>Additional Information (optional)</label>
    <textarea id="notes" placeholder="Notes..."></textarea>
    <button id="submit">Save Drive</button>
    <div id="status" class="status">Submits silently to Google Forms. Date auto-filled.</div>
  </section>
  <section id="view" class="card" style="display:none">
    <h2>Driving Records</h2>
    <iframe src="https://docs.google.com/spreadsheets/d/1mWv9qLkjmtTP-yIKymjmBvF6-MkuuA1xALk7M6ycGJM/edit?usp=sharing"></iframe>
  </section>
</main>
<nav class="tabbar">
  <div id="tabLog" class="tab active">Log</div>
  <div id="tabView" class="tab">Records</div>
</nav>
<script>
const tabLog = document.getElementById('tabLog'), tabView = document.getElementById('tabView');
const logSec = document.getElementById('log'), viewSec = document.getElementById('view');
tabLog.addEventListener('click', ()=>{tabLog.classList.add('active');tabView.classList.remove('active');logSec.style.display='block';viewSec.style.display='none'});
tabView.addEventListener('click', ()=>{tabView.classList.add('active');tabLog.classList.remove('active');viewSec.style.display='block';logSec.style.display='none'});

// Silent submit
const endpoint = "https://docs.google.com/forms/d/e/1FAIpQLSfvuNMRbaeXYqDSNTkBfAbERwwMzvGctfVkzBu6lLJrZbV5WA/formResponse";
document.getElementById('submit').addEventListener('click', async ()=>{
  const mins = document.getElementById('minutes').value.trim();
  if(!mins){document.getElementById('status').textContent='Please enter minutes.';return;}
  const notes = (document.getElementById('notes').value.trim() || 'None');
  const date = new Date().toISOString().split('T')[0];
  const data = new URLSearchParams();
  data.append('entry.2022091739', mins);
  data.append('entry.558305075', date);
  data.append('entry.1084333853', notes);
  try{
    await fetch(endpoint, {method:'POST',mode:'no-cors',body:data.toString(),headers:{'Content-Type':'application/x-www-form-urlencoded'}});
    document.getElementById('status').textContent='Saved âœ“';document.getElementById('minutes').value='';document.getElementById('notes').value='';
  }catch(e){document.getElementById('status').textContent='Save failed. Check connection.'}
});

// service worker register with relative path
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('./sw.js').catch(e=>console.warn(e));
}
</script>
</body>
</html>
